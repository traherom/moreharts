<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
   <head>
      <link rel="icon" href="image/favicon.ico" />
      <link rel="shortcut icon" href="image/favicon.ico" />
      <link rel="stylesheet" type="text/css" href="style/project3.css" />
      
      <script type="text/javascript" src="script/connectivity.js"></script>
      <script type="text/javascript" src="script/external.js"></script>
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
      <script type="text/javascript">
			// check immedietly that the user is actually logged in
			$.getJSON("http://judah.cedarville.edu/rmoreha/IsLoggedIn?callback=?", function(data)
 		   {
				if(!data.isLoggedIn == null)
					window.location = "index.html";

				if(data.isAdmin)
				{
					$(".nonAdminOnly").hide();
					$(".adminOnly").show();
				}
				else
				{
					$(".nonAdminOnly").show();
					$(".adminOnly").hide();
				}
 		   });
			
			/*
			 * When the page has loaded, fill in the usernames list with all user's names and fill the table
			 * with user and project information.
			 */
			function fillComponents()
			{
				// put the users name in the welcome
				$.getJSON("http://judah.cedarville.edu/rmoreha/IsLoggedIn?callback=?", function(data)
				{
					var myUserID = data.userID;
					
					if(data.userID != null)
					{
						$.getJSON("http://judah.cedarville.edu/rmoreha/GetUser?callback=?", {"userID": data.userID}, function(data)
					   {
							document.getElementById("loggedInUser").firstChild.nodeValue = data.name;
					   });
						
						if(data.isAdmin)
						{
							document.getElementById("adminButtonDiv").innerHTML = "<button id=\"adminButton\" onclick=\"window.location = 'admin.html';\">Admin</button>";
						}
					}
				
					// populate the usernames list from the database (also fill in the usernames in the table)
					$.getJSON("http://judah.cedarville.edu/rmoreha/GetUserList?callback=?", function(data)
					{
						for(var i = 0; i < data.users.length; ++i)
						{
							users.push(new Array(data.users[i].name, data.users[i].userName, data.users[i].userID, data.users[i].isAdmin));
							
							if(myUserID != data.users[i].userID && !data.users[i].isAdmin)
							{
								if(!data.users[i].hasPartner || data.users[i].firstPartner == myUserID || data.users[i].secondPartner == myUserID)
								{
									var partnerOption = "<option id=\"partner" + i + "\" value=" + data.users[i].userID + ">" + data.users[i].	name + "</option>";
									$("#firstPartnerSelect").append(partnerOption);
									$("#secondPartnerSelect").append(partnerOption);
								}
							}
						}
					});
			
					fillProjects();
					fillProjectSelects();
				});
			}
		</script>
      <title>Alex Laird | Web Applications (CS 4220) | Project 3 | Logged In</title>
	</head>
   
   <body id="project3LoggedIn" onload="externals(); fillComponents();">
   	<div id="content">
         <div id="header">
            <h1><span>Welcome to the People's Choice Awards</span></h1>
         </div><span><span>
         
         <div id="leftColumn">
         	<h1><span>&nbsp;</span></h1>
            <div id ="innerLeftSummary" align="center">
            	<h2><span>Results for</span></h2>
               <table id="projectsTable">
               </table>
            </div>
            <h3><span>&nbsp;</span></h3>
         </div>
         
         <div id="rightColumn">
         	<div id="standard">
               <h2><span>&nbsp;</span></h2>
                  <div align="center">
                     <h5><span>Account</span></h5>
                     <p class="p1">Welcome, <span id="loggedInUser">&nbsp;</span></p>
                     <button id="logout" onclick="logout();">Logout</button><br />
                     <button id="changePassword" onclick="editProfile();">Edit Profile</button><br />
                     <div id="adminButtonDiv">
					 	<input type="button" onclick="window.location='admin.html'" name="adminButton" value="Admin" class="adminOnly" />
						<br class="nonAdminOnly" />
					 </div>
                     <div id="profile_info">&nbsp;</div>
                     <table id="accountTable">                     
                        <tr class="nonAdminOnly">
                           <td><div align="right">Vote on</div></td>
                           <td><select id="voteSelect"></select></td>
                           <td><button id="vote" onclick="voteProject();">Vote!</button></td>
                        </tr>
                        <tr>
                           <td><div align="right">View Results for</div></td>
                           <td><select id="viewSelect"></select></td>
                           <td><button id="view" onclick="viewProject();">View!</button></td>
                        </tr>
                     </table>
                  </div>
               <h4><span>&nbsp;</span></h4>
            </div>
				<div id="editProfileDiv">
               <h2><span>&nbsp;</span></h2>
               <div align="center">
	               <h5><span>Account</span></h5><br />
                  <form id="editProfileForm" onsubmit="verifyProfile(); return false;">
                     <table id="editProfile">
                     	<tr>
                        	<td colspan="2"><b>Change Display Name:</b></td>
                        </tr>
                        <tr>
                        	<td>Display Name:</td>
                           <td><input type="text" id="displayNameTextField" name="displayNameTextField" /></td>
                        </tr>
                        
                        <tr><td>&nbsp;</td><td></td></tr>
                        
                        <tr>
                        	<td colspan="2"><b>Change Email:</b></td>
                        </tr>
                        <tr>
                        	<td>Email:</td>
                           <td><input type="text" id="emailTextField" name="emailTextField" /></td>
                        </tr>
                        
                        <tr class="nonAdminOnly"><td>&nbsp;</td><td></td></tr>
                        
                        <tr class="nonAdminOnly">
                        	<td><b>Partners:</b></td>
                           <td><select id="firstPartnerSelect"><option value="">None</option></select></td>
                        </tr>
                        
                        <tr class="nonAdminOnly">
                        	<td></td>
                           <td><select id="secondPartnerSelect"><option value="">None</option></select></td>
                        </tr>
                        
                        <tr><td>&nbsp;</td><td></td></tr>
                        
                     	<tr>
                        	<td colspan="2"><b>Change Password:</b></td>
                        </tr>
                        <tr>
                           <td><div align="right">Current password:</div></td>
                           <td><input type="password" id="oldPass" name="oldPass" /></td>
                        </tr>
                        <tr>
                           <td><div align="right">New password:</div></td>
                           <td><input type="password" id="newPass" name="newPass" /></td>
                        </tr>
                        <tr>
                           <td><div align="right">Confirm new password:</div></td>
                           <td><input type="password" id="retypeNewPass" name="retypeNewPass" /></td>
                        </tr>
                        <tr>
                        	<td></td>
                           <td id="change_info">&nbsp;</td>
                        </tr>
                        <tr>
                           <td><div align="right"><input type="reset" name="resetButton" value="Cancel" onclick="uneditProfile()"; /></div></td>
                           <td><div align="center"><input type="submit" name="changePasswordButton" value="Confirm Changes" /></div></td>
                        </tr>
                     </table>
                  </form>
               </div>
               <h4><span>&nbsp;</span></h4>
            </div>
         </div>
         
         <div id="footer">
            <p class="p1"><span>Go <a id="back" href="../cs4220.html" title="Back to my project's main page!">back</a> to my project's main menu.</span></p>
            <p class="p2">Created in 2010 by <a href="http://www.alexlaird.net/" title="This is my real website, which you should check out" rel="external">Alex Laird</a> and <a href="http://traherom.com" rel="external">Ryan Morehart</a>. If you feel you have reached this page in error, panic is an appropriate reaction.</p>
         </div>
      </span></span></div>
   </body>
</html>
